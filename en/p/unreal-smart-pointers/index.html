<!DOCTYPE html>
<html lang="en" dir="ltr">
    <head><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='Based on the official documentation, this article provides an interpretation of the content. (Many interpretations included) There may be differences from reality. Your feedback is appreciated. Unreal provides implementations of various smart pointers used in C&#43;&#43;. The provided classes include Shared Pointer, Weak Pointer, Unique Pointer, and an additional unique type called Shared Reference. Since UObject is managed by a separate memory tracking system, instances of classes that inherit from'>
<title>Unreal Smart Pointers</title>

<link rel='canonical' href='https://sangho0n.github.io/en/p/unreal-smart-pointers/'>

<link rel="stylesheet" href="/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css"><meta property='og:title' content='Unreal Smart Pointers'>
<meta property='og:description' content='Based on the official documentation, this article provides an interpretation of the content. (Many interpretations included) There may be differences from reality. Your feedback is appreciated. Unreal provides implementations of various smart pointers used in C&#43;&#43;. The provided classes include Shared Pointer, Weak Pointer, Unique Pointer, and an additional unique type called Shared Reference. Since UObject is managed by a separate memory tracking system, instances of classes that inherit from'>
<meta property='og:url' content='https://sangho0n.github.io/en/p/unreal-smart-pointers/'>
<meta property='og:site_name' content='sanghoon&#39;s dev-log'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='Unreal' /><meta property='article:tag' content='ì–¸ë¦¬ì–¼' /><meta property='article:tag' content='UE' /><meta property='article:tag' content='Smart Pointer' /><meta property='article:tag' content='Pointer' /><meta property='article:published_time' content='2024-03-05T17:31:11&#43;09:00'/><meta property='article:modified_time' content='2024-03-05T17:31:11&#43;09:00'/><meta property='og:image' content='https://sangho0n.github.io/en/p/unreal-smart-pointers/img/unreal.svg' />
<meta name="twitter:title" content="Unreal Smart Pointers">
<meta name="twitter:description" content="Based on the official documentation, this article provides an interpretation of the content. (Many interpretations included) There may be differences from reality. Your feedback is appreciated. Unreal provides implementations of various smart pointers used in C&#43;&#43;. The provided classes include Shared Pointer, Weak Pointer, Unique Pointer, and an additional unique type called Shared Reference. Since UObject is managed by a separate memory tracking system, instances of classes that inherit from"><meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:image" content='https://sangho0n.github.io/en/p/unreal-smart-pointers/img/unreal.svg' />
    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            if(!localStorage.getItem(colorSchemeKey)){
                localStorage.setItem(colorSchemeKey, "auto");
            }
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/en/">
                
                    
                    
                    
                        
                        <img src="/avatar_hufa2a3a1a2b6d47cfb712fe4c06494714_9812_300x0_resize_box_3.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">ðŸ˜€</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/en">sanghoon&#39;s dev-log</a></h1>
            <h2 class="site-description">Welcome to my blog!</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/sangho0n'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://www.instagram.com/sanghoon_eat/'
                        target="_blank"
                        title="Instagram"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/></svg>
                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/en/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/about/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="7" r="4" />
  <path d="M6 21v-2a4 4 0 0 1 4 -4h4a4 4 0 0 1 4 4v2" />
</svg>



                
                <span>About</span>
            </a>
        </li>
        
        
        <li >
            <a href='/en/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="https://sangho0n.github.io/ko/" >í•œêµ­ì–´</option>
                        
                            <option value="https://sangho0n.github.io/en/" selected>English</option>
                        
                    </select>
                </li>
            
            
            
                <li id="dark-mode-toggle">
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="8" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="16" cy="12" r="2" />
  <rect x="2" y="6" width="20" height="12" rx="6" />
</svg>



                    <span></span>
                </li>
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title"></h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#types">Types</a></li>
    <li><a href="#benefits">Benefits</a></li>
    <li><a href="#helper-classes-and-functions">Helper Classes and Functions</a></li>
    <li><a href="#implementation-details">Implementation Details</a>
      <ol>
        <li><a href="#speed">Speed</a></li>
        <li><a href="#intrusive-accessors">Intrusive Accessors</a></li>
        <li><a href="#type-casting">Type Casting</a></li>
        <li><a href="#thread-safety">Thread Safety</a></li>
      </ol>
    </li>
    <li><a href="#additional-notes">Additional Notes</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="has-image main-article">
    <header class="article-header">
        <div class="article-image">
            <a href="/en/p/unreal-smart-pointers/">
                
                    <img src="/en/p/unreal-smart-pointers/img/unreal.svg" loading="lazy" alt="Featured image of post Unreal Smart Pointers" />
                
            </a>
        </div>
    

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/en/categories/unreal/" >
                Unreal
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/en/p/unreal-smart-pointers/">Unreal Smart Pointers</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">2024-03-05</time>
            </div>
        

    </footer>
    

    
        <footer class="article-translations">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



            <div>
                
                    <a href="https://sangho0n.github.io/ko/p/%EC%96%B8%EB%A6%AC%EC%96%BC-%EC%8A%A4%EB%A7%88%ED%8A%B8-%ED%8F%AC%EC%9D%B8%ED%84%B0/" class="link">í•œêµ­ì–´</a>
                
            </div>
        </footer>
    
</div>

</header>

    <section class="article-content">
    
    
    <p>Based on the official documentation, this article provides an interpretation of the content. (Many interpretations included)
There may be differences from reality. Your feedback is appreciated.</p>
<hr>
<p>Unreal provides implementations of various smart pointers used in C++. The provided classes include Shared Pointer, Weak Pointer, Unique Pointer, and an additional unique type called Shared Reference. Since UObject is managed by a separate memory tracking system, instances of classes that inherit from UObject cannot be wrapped with smart pointers. (A memory reclaiming structure different from garbage collection; RAII pattern)</p>
<h2 id="types">Types</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Type</th>
<th>Usage</th>
</tr>
</thead>
<tbody>
<tr>
<td>TSharedPtr</td>
<td>Shared Pointer is a class that owns the object it wraps. It prevents the object from being destroyed by external factors while it is owned. Ultimately, when the number of shared pointers (or references) owning the object becomes 0, it manages the object&rsquo;s destruction. Shared pointers can exist even when they are not wrapping any object. When the wrapped object is not null, a shared reference can be created at any time.</td>
</tr>
<tr>
<td>TSharedRef</td>
<td>Similar to a shared pointer but differs in that the wrapped object cannot be null. Since null is not possible, it can be converted to a shared pointer at any time, and the pointed object is always in a valid state. It is used when you want to clearly define ownership or ensure that the object is not null.</td>
</tr>
<tr>
<td>TWeakPtr</td>
<td>Similar to a shared pointer but does not own the object, therefore does not impact the object&rsquo;s lifecycle. It can be useful for breaking <strong>reference cycles</strong> but since the object being referenced can become null at any time without warning, it is better to convert it to a shared pointer for safe access.</td>
</tr>
<tr>
<td>TUniquePtr</td>
<td>A unique pointer owns the object exclusively. It can transfer ownership but cannot be shared. Attempting to copy a unique pointer results in a compile error. When it goes out of scope, it automatically releases the object it owns from memory.</td>
</tr>
</tbody>
</table></div>
<p><em><strong>Reference cycle</strong>: A phenomenon that occurs when two or more objects reference each other. If the reference count does not reach 0, the objects will not be released, leading to memory leaks.</em></p>
<h2 id="benefits">Benefits</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Benefit</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td>Prevention of Memory Leaks</td>
<td>By automatically destroying objects, it prevents memory leaks.</td>
</tr>
<tr>
<td>Weak References</td>
<td>Solves circular reference problems and prevents dangling pointers.</td>
</tr>
<tr>
<td>Thread Safety Assurance (optional)</td>
<td>Additional code can be written to ensure thread safety when needed. (Overhead exists)</td>
</tr>
<tr>
<td>Runtime Safety</td>
<td>Shared references cannot be null and can release references at any time, ensuring runtime stability.</td>
</tr>
<tr>
<td>Intention Conveyance</td>
<td><strong>Owners and observers</strong> can be easily distinguished.</td>
</tr>
<tr>
<td>Memory Advantages</td>
<td>All these functions can be performed with just double the size of a pointer variable in C++ (based on 64-bits; including 16 bytes for reference control). However, a unique pointer has the same size as a C++ pointer.</td>
</tr>
</tbody>
</table></div>
<p><em>Owner manages and controls the lifespan of the object. Through shared pointers and unique pointers, ownership of the object is maintained, and when no longer needed, the object is released from memory. Observers reference the object but do not own it (Weak pointers). When the owner of the object deletes it, the observer should automatically become null.</em></p>
<h2 id="helper-classes-and-functions">Helper Classes and Functions</h2>
<div class="table-wrapper"><table>
<thead>
<tr>
<th>Helper</th>
<th>Explanation</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong><em>Classes</em></strong></td>
<td></td>
</tr>
<tr>
<td><strong>TSharedFromThis</strong></td>
<td>Inheriting from TSharedFromThis adds the AsShared and SharedThis methods to the class. These methods help in obtaining a TSharedRef for the object.</td>
</tr>
<tr>
<td><strong><em>Functions</em></strong></td>
<td></td>
</tr>
<tr>
<td><strong>MakeShared</strong> and <strong>MakeShareable</strong></td>
<td>MakeShared function creates a TSharedPtr from a regular C++ pointer. This function allocates a new object instance and reference controller in a single memory block. The object must have a public constructor. MakeShareable is also used to create a TSharedPtr from a C++ pointer. This function works even when the object&rsquo;s constructor is private. This allows you to obtain ownership of an object you did not create, and additionally, you can provide custom logic when the destructor is called. Due to these additional features, it allows for more flexible programming compared to MakeShared, but it also comes with overhead.</td>
</tr>
<tr>
<td><strong>StaticCastSharedRef</strong> and <strong>StaticCastSharedPtr</strong></td>
<td>Utility functions that support static casting (mainly downcasting)</td>
</tr>
<tr>
<td>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â <strong>ConstCastSharedRef</strong> and <strong>ConstCastSharedPtr</strong>Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â </td>
<td>Each returns a reference or a pointer type variable with const-ness being mutable.</td>
</tr>
</tbody>
</table></div>
<p>Example of adding additional logic to the destructor using MakeShareable</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-CPP" data-lang="CPP"><span class="line"><span class="cl">	<span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">FOnlineSession</span><span class="o">&gt;</span> <span class="n">SharedPtr</span> <span class="o">=</span> <span class="n">MakeShareable</span><span class="p">(</span><span class="k">new</span> <span class="n">FOnlineSession</span><span class="p">(),</span> <span class="p">[](</span><span class="n">FOnlineSession</span><span class="o">*</span> <span class="n">ObjToDelete</span><span class="p">)</span><span class="o">-&gt;</span> <span class="kt">void</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">    	<span class="c1">// Implement custom destructor logic
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">ObjToDelete</span><span class="o">-&gt;</span><span class="n">PerformAdditionalCleanup</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="k">delete</span> <span class="n">ObjToDelete</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">});</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="implementation-details">Implementation Details</h2>
<p>Unreal&rsquo;s smart pointer library is implemented to preserve both functionality and efficiency.</p>
<h3 id="speed">Speed</h3>
<p>While smart pointers are very useful in high-level systems like resource management and tool programming, they are not suitable for low-level engine code like rendering due to their slower performance compared to C++ raw pointers.</p>
<p>Unreal&rsquo;s smart pointer library has the following performance benefits:</p>
<ul>
<li>All operations are performed in constant time.</li>
<li>In Shipping builds, dereferencing in most smart pointers is as fast as in C++ raw pointers.</li>
<li>Copying smart pointers does not require new memory allocation.</li>
<li>Thread-safe smart pointers do not require locking.</li>
</ul>
<p>However, there are also drawbacks:</p>
<ul>
<li>Creating and copying new smart pointers have overhead compared to C++ raw pointers.</li>
<li>Managing reference counts adds an additional overhead to basic operations.</li>
<li>Some smart pointers use more memory than C++ raw pointers.</li>
<li>Reference controllers require two heap memory allocations. Using MakeShared instead of MakeSharable can avoid the second memory allocation.</li>
</ul>
<h3 id="intrusive-accessors">Intrusive Accessors</h3>
<p>Typically, the instance referenced by a smart pointer is not aware of the smart pointers referencing it (known as non-intrusive). However, Unreal&rsquo;s smart pointer library allows accessors to obtain references from smart pointers that reference themselves through TSharedFromThis.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FRegistryObject</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">FMyBaseClass</span><span class="o">:</span> <span class="k">public</span> <span class="n">TSharedFromThis</span><span class="o">&lt;</span><span class="n">FMyBaseClass</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">RegisterAsBaseClass</span><span class="p">(</span><span class="n">FRegistryObject</span><span class="o">*</span> <span class="n">RegistryObject</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// Access a shared reference to &#39;this&#39;.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// We are directly inherited from &lt;TSharedFromThis&gt; , so AsShared() and SharedThis(this) return the same type.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">TSharedRef</span><span class="o">&lt;</span><span class="n">FMyBaseClass</span><span class="o">&gt;</span> <span class="n">ThisAsSharedRef</span> <span class="o">=</span> <span class="n">AsShared</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// RegistryObject expects a TSharedRef&lt;FMyBaseClass&gt;, or a TSharedPtr&lt;FMyBaseClass&gt;. TSharedRef can implicitly be converted to a TSharedPtr.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">RegistryObject</span><span class="o">-&gt;</span><span class="n">Register</span><span class="p">(</span><span class="n">ThisAsSharedRef</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">FMyDerivedClass</span> <span class="o">:</span> <span class="k">public</span> <span class="n">FMyBaseClass</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">virtual</span> <span class="kt">void</span> <span class="nf">Register</span><span class="p">(</span><span class="n">FRegistryObject</span><span class="o">*</span> <span class="n">RegistryObject</span><span class="p">)</span> <span class="k">override</span>
</span></span><span class="line"><span class="cl">        <span class="p">{</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// We are not directly inherited from TSharedFromThis&lt;&gt;, so AsShared() and SharedThis(this) return different types.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// AsShared() will return the type originally specified in TSharedFromThis&lt;&gt; - TSharedRef&lt;FMyBaseClass&gt; in this example.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// SharedThis(this) will return a TSharedRef with the type of &#39;this&#39; - TSharedRef&lt;FMyDerivedClass&gt; in this example.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="c1">// The SharedThis() function is only available in the same scope as the &#39;this&#39; pointer.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">TSharedRef</span><span class="o">&lt;</span><span class="n">FMyDerivedClass</span><span class="o">&gt;</span> <span class="n">AsSharedRef</span> <span class="o">=</span> <span class="n">SharedThis</span><span class="p">(</span><span class="k">this</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">            <span class="c1">// RegistryObject will accept a TSharedRef&lt;FMyDerivedClass&gt; because FMyDerivedClass is a type of FMyBaseClass.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>            <span class="n">RegistryObject</span><span class="o">-&gt;</span><span class="n">Register</span><span class="p">(</span><span class="n">ThisAsSharedRef</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span><span class="line"><span class="cl">    <span class="k">class</span> <span class="nc">FRegistryObject</span>
</span></span><span class="line"><span class="cl">    <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="c1">// This function will accept a TSharedRef or TSharedPtr to FMyBaseClass or any of its children.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>        <span class="kt">void</span> <span class="nf">Register</span><span class="p">(</span><span class="n">TSharedRef</span><span class="o">&lt;</span><span class="n">FMyBaseClass</span><span class="o">&gt;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="p">};</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>As mentioned, by inheriting from TSharedFromThis, the class can use AsShared and SharedThis methods to obtain a shared pointer (TSharedRef) for its instance. However, in cases where a class does not directly inherit TSharedFromThis, the return value will differ. It is advisable to set the shared pointer of the base class directly when using a factory class or a method that takes a shared reference (such as <code>FRegistryObject::Register(TSharedRef&lt;FMyBaseClass&gt;)</code>).</p>
<p><strong>Note that using AsShared and SharedThis in the constructor can lead to crashes or assertions, as they return the smart pointer of the instantiated object.</strong></p>
<h3 id="type-casting">Type Casting</h3>
<p>Unreal&rsquo;s smart pointer library allows for casting similar to C++ pointers.</p>
<ul>
<li>Up Casting: Implicitly performed, similar to C++ raw pointers (automatic conversion from a base class pointer to a derived class pointer).</li>
<li>Const Casting: Perform using ConstCastSharedPtr/Ref methods.</li>
<li>Static Casting: Perform using StaticCastSharedPtr/Ref methods (mainly downcasting).</li>
<li>Dynamic Casting: Not supported as there is no runtime type information (RTTI).</li>
</ul>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">FDragDropOperation</span><span class="o">&gt;</span> <span class="n">Operation</span> <span class="o">=</span> <span class="n">DragDropEvent</span><span class="p">.</span><span class="n">GetOperation</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Some code for validating that the FDragDropOperation is actually an FAssetDragDropOp through other means...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">// We can now cast with StaticCastSharedPtr.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">FAssetDragDropOp</span><span class="o">&gt;</span> <span class="n">DragDropOp</span> <span class="o">=</span> <span class="n">StaticCastSharedPtr</span><span class="o">&lt;</span><span class="n">FAssetDragDropOp</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Operation</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="thread-safety">Thread Safety</h3>
<p>By default, smart pointers are only safe in a single-threaded environment. If you want thread-safe versions, you can use the following classes:</p>
<ul>
<li>TSharedPtr&lt;T, ESPMode::ThreadSafe&gt;</li>
<li>TSharedRef&lt;T, ESPMode::ThreadSafe&gt;</li>
<li>TWeakPtr&lt;T, ESPMode::ThreadSafe&gt;</li>
<li>TSharedFromThis&lt;T, ESPMode::ThreadSafe&gt;</li>
</ul>
<p>These classes perform atomic operations on reference counts, making them slightly slower than the default classes but operationally very similar to C++ raw pointers.</p>
<ul>
<li>Reading and copying operations are always thread-safe.</li>
<li>Writing and resetting operations must be synchronized for safety.</li>
</ul>
<h2 id="additional-notes">Additional Notes</h2>
<ul>
<li>When passing shared pointers/references as method arguments, there is overhead due to reference counting and dereferencing. If possible, pass them as <code>const&amp;</code>.</li>
<li>Shared pointers allow forward declaration for incomplete classes.</li>
<li>As mentioned earlier, smart pointers and garbage collection (<a class="link" href="https://docs.unrealengine.com/5.2/en-US/unreal-object-handling-in-unreal-engine/"  target="_blank" rel="noopener"
    >UObject Handling</a>) are separate memory management systems.</li>
</ul>
<p>Forward declaration example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-cpp" data-lang="cpp"><span class="line"><span class="cl"><span class="c1">// Forward declaration
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">IncompleteType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Shared pointer for the forward-declared type
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">IncompleteType</span><span class="o">&gt;</span> <span class="n">incompleteTypePtr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// When the definition of IncompleteType is complete, you can create a shared pointer for that type
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">TSharedPtr</span><span class="o">&lt;</span><span class="n">IncompleteType</span><span class="o">&gt;</span> <span class="n">incompleteTypePtr2</span> <span class="o">=</span> <span class="n">MakeShared</span><span class="o">&lt;</span><span class="n">IncompleteType</span><span class="o">&gt;</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div>
</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/en/tags/unreal/">Unreal</a>
        
            <a href="/en/tags/%EC%96%B8%EB%A6%AC%EC%96%BC/">ì–¸ë¦¬ì–¼</a>
        
            <a href="/en/tags/ue/">UE</a>
        
            <a href="/en/tags/smart-pointer/">Smart Pointer</a>
        
            <a href="/en/tags/pointer/">Pointer</a>
        
    </section>


    
    <section class="article-copyright">
        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <path d="M14.5 9a3.5 4 0 1 0 0 6" />
</svg>



        <span>Licensed under CC BY-NC-SA 4.0</span>
    </section>
    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title"></h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="has-image">
    <a href="/en/p/starting-unreal-gas/">
        
        
            <div class="article-image">
                
                    <img src="/en/p/starting-unreal-gas/img/unreal.svg" loading="lazy" data-key="" data-hash="/en/p/starting-unreal-gas/img/unreal.svg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Starting Unreal GAS</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/en/p/unreal-enhanced-input/">
        
        
            <div class="article-image">
                
                    <img src="/en/p/unreal-enhanced-input/img/unreal.svg" loading="lazy" data-key="" data-hash="/en/p/unreal-enhanced-input/img/unreal.svg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Unreal Enhanced Input</h2>
        </div>
    </a>
</article>

            
                
<article class="has-image">
    <a href="/en/p/overview-of-unreal-gas/">
        
        
            <div class="article-image">
                
                    <img src="/en/p/overview-of-unreal-gas/img/unreal.svg" loading="lazy" data-key="" data-hash="/en/p/overview-of-unreal-gas/img/unreal.svg"/>
                
            </div>
        

        <div class="article-details">
            <h2 class="article-title">Overview of Unreal GAS</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2023 - 
        
        2024 Sanghoon, Han
    </section>
    
    <section class="powerby">
         <br />
        
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://lib.baomitu.com/photoswipe/4.1.3/photoswipe.min.js"crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://lib.baomitu.com/photoswipe/4.1.3/photoswipe-ui-default.min.js"crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://lib.baomitu.com/photoswipe/4.1.3/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://lib.baomitu.com/photoswipe/4.1.3/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src=""crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
